type: provider
query_config:
  query_name: by_transform_name_dependent_transform
  query_value:
    dep_tf_name: 01-demo-create-source-event
    tf_name: 02-demo-source-to-staging-event
config:
    provider_package: hmd_operators.trino
    provider_class: TrinoOperator
    params:
        sql: |


              INSERT INTO {{ ns_context['schema_name'] }}_staging.event (
                  SELECT
                    
              detail.code AS "event_detail.code",
              detail.message AS "event_detail.message",
              "type" AS "type",
              "timestamp" AS "timestamp",
              "serial_number" AS "serial_number",
              "case" AS "case",
                    {{ ns_context["partition_values"]["iso_date"] }} AS "p_iso_date", 
                    {{ ns_context["partition_values"]["serial_num"] }} AS "p_serial_num", 
                    {{ ns_context["partition_values"]["dev_run"] }} AS "p_dev_run"
                  FROM {{ ns_context['schema_name'] }}_source.event_{{ ns_context['table_suffix'].replace('-', '_') }}
              )
        trino_conn_id: trino_conn_overwrite
        autocommit: true
    run_params:
        schema_name: demo
        table_suffix: "{source_path[1]}_{source_path[2]}_{source_path[3]}"
        partition_values:
            iso_date: "'{source_path[1]}'"
            serial_num: "'{source_path[2]}'"
            dev_run: "'{source_path[3]}'"