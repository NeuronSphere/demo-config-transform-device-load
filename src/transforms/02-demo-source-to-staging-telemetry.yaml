type: provider
query_config:
  query_name: by_transform_name_dependent_transform
  query_value:
    dep_tf_name: 01-demo-create-source-telemetry
    tf_name: 02-demo-source-to-staging-telemetry
config:
    provider_package: hmd_operators.trino
    provider_class: TrinoOperator
    params:
        sql: |


              INSERT INTO {{ ns_context['schema_name'] }}_staging.telemetry_0_1_1 (
                  SELECT
                    
              position.x AS "position_x",
              position.y AS "position_y",
              position.z AS "position_z",
              rotation.pitch AS "rotation_pitch",
              rotation.roll AS "rotation_roll",
              rotation.yaw AS "rotation_yaw",
              "type" AS "type",
              "timestamp" AS "timestamp",
              "serial_number" AS "serial_number",
              "case" AS "case",
                      
                    cast(iso_date as DATE) AS "p_iso_date"
                      
                      
                    serial_num AS "p_serial_num", 
                      
                      
                    dev_run AS "p_dev_run"
                      
                  FROM {{ ns_context['schema_name'] }}_source.telemetry_0_1_1_{{ ns_context['table_suffix'].replace('-', '_') }}
              )
        trino_conn_id: trino_conn_overwrite
        autocommit: true
    run_params:
        schema_name: demo
        table_suffix: "{source_path[1]}_{source_path[2]}_{source_path[3]}"
        partition_values:
            iso_date: "'{source_path[1]}'"
            serial_num: "'{source_path[2]}'"
            dev_run: "'{source_path[3]}'"