type: provider
query_config:
  query_name: by_transform_name_dependent_transform
  query_value:
    dep_tf_name: 02-demo-source-to-staging-event
    tf_name: 03-demo-staging-to-final-event
config:
    provider_package: hmd_operators.trino
    provider_class: TrinoOperator
    params:
        sql: |
            INSERT INTO demo_final.event_0_1_1 (
              SELECT
                "event_detail_code",
                "event_detail_message",
                "type",
                "timestamp",
                "serial_number",
                "case",
                "p_iso_date", 
                "p_serial_num", 
                "p_dev_run"
              FROM demo_staging.event_0_1_1
              WHERE
                  
                p_iso_date = cast({{ ns_context["partition_values"]["iso_date"] }} as DATE) AND
                  
                  
                p_serial_num = {{ ns_context["partition_values"]["serial_num"] }} AND 
                  
                  
                p_dev_run = {{ ns_context["partition_values"]["dev_run"] }}
                  
                AND (type = 'event')
            )
        trino_conn_id: trino_conn_overwrite
        autocommit: true
    run_params:
        schema_name: demo
        table_suffix: "{source_path[1]}_{source_path[2]}_{source_path[3]}"
        partition_values:
            iso_date: "'{source_path[1]}'"
            serial_num: "'{source_path[2]}'"
            dev_run: "'{source_path[3]}'"